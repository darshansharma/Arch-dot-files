Okta.AuthenticationMonitor=function(e,t,r,n){var o=_okta.delay,i=_okta.each,a=_okta.find,s=_okta.last,u=Okta.fn.storage.unwrapVal,d=Okta.fn.url.getOktaFederatedRequestMatchPatterns,c=false,m={};var l="recorded_auth_interaction_",f="PLUGIN_SETTINGS",h="OKTA_DOMAIN",g="VERSION",p="SESSION_COOKIE",b=20,v=2e4;function R(t){return e.get(l+t)}function L(t,r){e.set(l+t,r)}function S(t){e.clear(l+t)}function q(e,t){if(!t||!e){return}t.push({url:e.url,startTimeStamp:e.timeStamp});L(e.tabId,t)}function w(e,t){var r=s(t);r.method=e.method;r.statusCode=e.statusCode;r.endTimeStamp=e.timeStamp;r.responseTimeMs=Math.round(r.endTimeStamp-r.startTimeStamp);r.error=e.error;L(e.tabId,t)}function _(e,t){var r="Auth Interaction: ";i(e,function(e){e.startTimeStamp=undefined;e.endTimeStamp=undefined;e.url=encodeURI(e.url)});r+=JSON.stringify(e);S(t);I(r)}function I(n){var o=u(t.get(h));if(!o){Log.warn("Failed to find Okta domain from persistent storage. Not "+"logging interaction");return}var i=u(t.get(g));if(!i){Log.warn("Failed to find plugin version from persistent storage. Not "+"logging interaction");return}var a=u(e.get(p));if(!a||!a.sid||!a.DT){Log.warn("Failed to find a valid Okta session. Not logging interaction");return}r.ajax({url:o+"/api/plugin/2/log?plugin_version="+i.backgroundVersion+"-"+i.contentVersion,type:"POST",beforeSend:function(e){e.setRequestHeader("Accept","application/json;charset=utf-8");e.setRequestHeader("Plugin-Sid",a.sid);e.setRequestHeader("X-Session-Id",a.sid);e.setRequestHeader("X-Device-Token",a.DT)},data:{message:n,logLevel:"INFO"}})}function O(e){if(!e||!e.transitionQualifiers){return false}return e.transitionType==="auto_subframe"||!!a(e.transitionQualifiers,function(e){return e==="client_redirect"||e==="server_redirect"})}function T(){if(n==="edge"){Log.warn("AuthenticationMonitor::isSupported: this functionality "+"is currently not supported on Microsoft Edge");return false}if(!chrome.webRequest.onSendHeaders||!chrome.webRequest.onCompleted||!chrome.webRequest.onBeforeRedirect||!chrome.webRequest.onErrorOccurred||!chrome.webNavigation.onCommitted||!chrome.tabs.onRemoved){Log.warn("AuthenticationMonitor::isSupported: Current version of "+"the browser does not support this functionality");return false}return true}function A(e){q(e,[])}function C(e){var t=R(e.tabId);if(!t||t.length===0){return}w(e,t)}function k(e){var t=R(e.tabId);if(!t||t.length===0){return}if(t.length===1&&t[0].url===e.url){return}q(e,t)}function y(e){var t=R(e.tabId);if(!t||t.length===0){return}var r=t.length;if(r===1&&t[0].url===e.url){return}if(r===2&&e.method!=="POST"){S(e.tabId);return}var n=s(t);if(n.url!==e.url){q({timeStamp:n.endTimeStamp,url:e.url},t);n=s(t);r++}if(r===b){n.oktaError="request queue reached maximum capacity of "+b+" web requests"}w(e,t);if(e.statusCode>=400||e.error||r===b){_(t,e.tabId);return}if((e.method==="GET"||e.method==="POST")&&e.statusCode<300){o(function(){var t=R(e.tabId);if(!t){return}if(t.length>r){return}_(t,e.tabId)},v)}}function M(e){var t=R(e.tabId);if(!t||t.length<=1){return}if(s(t).method==="GET"&&!O(e)){t.pop();_(t,e.tabId);return}}function N(e){S(e)}function E(){if(!c){Log.info("AuthenticationMonitor::removeRequestListeners: "+"no listeners are attached to be removed");return}chrome.webRequest.onSendHeaders.removeListener(A);chrome.webRequest.onCompleted.removeListener(C);chrome.webRequest.onSendHeaders.removeListener(k);chrome.webRequest.onBeforeRedirect.removeListener(y);chrome.webRequest.onCompleted.removeListener(y);chrome.webRequest.onErrorOccurred.removeListener(y);chrome.webNavigation.onCommitted.removeListener(M);chrome.tabs.onRemoved.removeListener(N);c=false;Log.info("AuthenticationMonitor::removeRequestListeners: "+"removed all listeners")}function H(){if(c){Log.info("AuthenticationMonitor::addRequestListeners: "+"listeners already attached");return}var e=d();chrome.webRequest.onSendHeaders.addListener(A,{urls:e},["requestHeaders"]);chrome.webRequest.onCompleted.addListener(C,{urls:e});chrome.webRequest.onSendHeaders.addListener(k,{urls:["<all_urls>"],types:["main_frame"]},["requestHeaders"]);chrome.webRequest.onBeforeRedirect.addListener(y,{urls:["<all_urls>"],types:["main_frame"]});chrome.webRequest.onCompleted.addListener(y,{urls:["<all_urls>"],types:["main_frame"]});chrome.webRequest.onErrorOccurred.addListener(y,{urls:["<all_urls>"],types:["main_frame"]});chrome.webNavigation.onCommitted.addListener(M);chrome.tabs.onRemoved.addListener(N);c=true;Log.info("AuthenticationMonitor::addRequestListeners: "+"added all listeners")}m.initialize=function(){if(!T()){return}var e=u(t.get(f));if(!e||!e.orgSettings||!e.orgSettings.pluginAuthFailureDetectionEnabled){Log.info("AuthenticationMonitor::initialize: Auth monitoring feature "+"is disabled");E();return}H()};return m};