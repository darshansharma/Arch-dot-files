Okta.startBackgroundScript=function(e,t,r,o){var n="CONTENT_SCRIPT",a="LAST_CHECK",s="INJECTION_COUNT",u="DBG_PLUGIN_SETTINGS",i=5,c=1e3,l=Okta.Q.when,g=Okta.fn.storage.unwrapVal,f=Okta.fn.storage.wrapVal,k=Okta.fn.base.timestamp,p=_okta.isNull,d=_okta.compose,T=_okta.isUndefined,y=Okta.Q,S=_okta.partial,C=Okta.fn.base.orDefault;function b(e){return"_lock_"+e}function h(e){t.set(b(e),null);return true}function m(e){var r=k(),o=b(e),n=t.get(o);if(!n||r>n.lockTime+c){t.set(o,{lockTime:r});return true}else{return false}}function v(n,a,s){switch(n){case"getSessionState":return t.get(s.key);case"setSessionState":return t.set(s.key,s.val);case"getPersistentState":return r.get(s.key);case"setPersistentState":return r.set(s.key,s.val);case"getTabId":return a;case"getBrowserType":return e.getType();case"getBackgroundVersion":return e.getBackgroundVersion();case"unlockSessionKey":return h(s.key);case"lockSessionKey":return m(s.key);case"request":return o.ajax(s);case"openTab":return e.openTab(s.url);case"openTabForAccountChooser":if(T(e.openTabForAccountChooser)){return y({errorCode:"not supported by this version of the plugin",url:s.url})}return e.openTabForAccountChooser(s.url);case"closeTab":return e.closeTab(a);case"getCookies":if(T(e.getCookies)){return y({errorCode:"not supported by this version of the plugin"})}return e.getCookies(s.key.hostUrl,s.key.cookieNames);case"getLocalStorageUsage":if(T(e.getLocalStorageUsage)){return y({errorCode:"not supported by this version of the plugin"})}return e.getLocalStorageUsage().fail(function(e){return y({errorCode:"failed to get the local storage usage: "+e})});default:return y({errorCode:"Unknown msg type: "+n})}}var I=d(C(0),g,S(r.get,s));var _=d(S(r.set,s),f);var O=d(C(0),g,S(r.get,u));function N(){var e=O();return e&&e.useLocalJS}function U(t,r){if(e.getType()==="chrome"){if(t.frameId===0){_(r+1)}}else{_(r+1)}}e.on("injectReady",function(t){var o=g(r.get(n)),s=I();if(N()){e.injectScript(t,null);return}if(p(o)){_(0)}else if(s<i){U(t,s)}else{_(0);r.set(n,f(null));r.set(a,f(null));o=null}e.injectScript(t,o)});e.on("messageFromContent",function(t){var r=t.msg,o=v(r.type,t.tabId,r.data);l(o,function(o){e.post({msg:{id:r.id,data:o},tabId:t.tabId,portInfo:t.portInfo})}).done()})};